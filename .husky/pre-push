#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Check if README.md is being pushed
if git diff --name-only HEAD @{push} | grep -q "README.md"; then
  # Get diff excluding the doctoc section
  if git diff HEAD @{push} README.md | grep -v "<!-- START doctoc" | grep -v "<!-- END doctoc" | grep -v "<!-- THIS SECTION IS GENERATED AUTOMATICALLY ON PUSH" | grep -q "^+"; then
    echo "README.md changes detected outside of TOC. Running doctoc..."
    npx doctoc README.md
    
    # Stage the doctoc changes
    git add README.md
    
    # Amend the last commit with the TOC changes
    git commit --amend --no-edit
  else
    echo "No significant README changes detected outside of TOC section."
  fi
fi
