"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("@constructor-io/constructorio-client-javascript"),n=require("downshift");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=o(e),r=o(t);let c=0;const l=({setQuery:e,items:t,onSubmit:o,cioClient:i,previousQuery:r="",onChange:l})=>n.useCombobox({id:"cio-autocomplete-"+c++,items:t,itemToString:e=>(null==e?void 0:e.value)||"",onInputValueChange:async({inputValue:t=""})=>{e(t),l&&l(t)},onSelectedItemChange({selectedItem:t}){var n;t&&(e(t.value||""),(null==t?void 0:t.value)&&(o&&o({item:t,originalQuery:r}),(null===(n=null==t?void 0:t.data)||void 0===n?void 0:n.url)||null==i||i.tracker.trackSearchSubmit(t.value,{original_query:r}),null==i||i.tracker.trackAutocompleteSelect(t.value,{original_query:r,section:t.section})))}}),a=(t,n,o)=>{const[i,r]=e.useState({}),c=((t,n=250)=>{const[o,i]=e.useState(t);return e.useEffect((()=>{const e=setTimeout((()=>{i(t)}),n);return()=>{clearTimeout(e)}}),[t,n]),o})(t),l={resultsPerSection:{}};return o&&(l.resultsPerSection=o.reduce(((e,t)=>{var n;return{...e,[t.identifier]:(null===(n=null==t?void 0:t.parameters)||void 0===n?void 0:n.numResults)||8}}),{})),e.useEffect((()=>{c?null==n||n.autocomplete.getAutocompleteResults(c,l).then((e=>{const t={};Object.keys(e.sections).forEach((n=>{t[n]=e.sections[n].map((e=>({...e,section:n})))})),r(t)})):c||r({})}),[c,n]),i},s=[{identifier:"Search Suggestions",type:"autocomplete"},{identifier:"Products",type:"autocomplete"}],u=t=>{const n="What can we help you find today?",{onSubmit:o,onChange:i,openOnFocus:c,apiKey:u,cioJsClient:d,placeholder:m=n,sections:p=s,zeroStateSections:f}=t,[v,g]=e.useState(""),h=(t=>{const n=e.useRef();return e.useEffect((()=>{n.current=t}),[t]),n.current})(v),x=(({apiKey:t,cioJsClient:n})=>{const[o,i]=e.useState(n);return e.useEffect((()=>{if(t&&!n){const e=new r.default({apiKey:t,sendTrackingEvents:!0});i(e)}else n&&i(n)}),[t,n]),o})({apiKey:u,cioJsClient:d}),y=!v.length&&f;let b=y?f:p;p&&!Array.isArray(p)&&(console.error("useCioAutocomplete expects sections to reference an array of section configuration objects"),b=[]),f&&!Array.isArray(f)&&(console.error("useCioAutocomplete expects zeroStateSections to reference an array of section configuration objects"),b=[]);const E=null==b?void 0:b.filter((e=>"autocomplete"===e.type||!e.type)),S=null==b?void 0:b.filter((e=>"recommendations"===e.type)),C=a(v,x,E),P=((t,n)=>{const[o,i]=e.useState({});return e.useEffect((()=>{t&&Array.isArray(n)&&0!==n.length&&(async()=>{const e=await Promise.all(n.map((({identifier:e,parameters:n})=>t.recommendations.getRecommendations(e,n)))),o={};e.forEach((({response:e})=>{const{pod:t,results:n}=e;(null==t?void 0:t.id)&&(o[t.id]=null==n?void 0:n.map((e=>({...e,section:t.id}))))})),i(o)})()}),[t]),o})(x,S),w={...C,...P},I=[];null==b||b.forEach((e=>{const{identifier:t,data:n}=e,o=w[t]||n;o&&void 0!==o&&I.push({...e,data:o})}));const k=[];null==I||I.forEach((e=>{(null==e?void 0:e.data)&&k.push(...e.data)}));const N=l({setQuery:g,onChange:i,items:k,onSubmit:o,cioClient:x,previousQuery:h}),{isOpen:A,getMenuProps:M,getLabelProps:F,openMenu:q,closeMenu:Q,getComboboxProps:z}=N;return{query:v,sections:I,isOpen:A,getMenuProps:()=>({...M(),className:"cio-results","data-testid":"cio-results"}),getLabelProps:F,openMenu:q,closeMenu:Q,getItemProps:({item:e,index:t=0,sectionIdentifier:n="Products"})=>{const o=(({activeSections:e,sectionIdentifier:t})=>{let n=0;return t&&e.find((e=>{var o;return(null==e?void 0:e.identifier)===t||(n+=(null===(o=null==e?void 0:e.data)||void 0===o?void 0:o.length)||0,!1)})),n})({activeSections:I,sectionIdentifier:n});return{...N.getItemProps({item:e,index:t+o}),className:"cio-item","data-testid":`cio-item-${n.replace(" ","")}`}},getInputProps:()=>({...N.getInputProps(),value:v,onFocus:()=>{var e;t.onFocus&&t.onFocus(),y&&!1!==c&&N.openMenu(),null===(e=null==x?void 0:x.tracker)||void 0===e||e.trackInputFocus()},className:"cio-input","data-testid":"cio-input",placeholder:m}),getFormProps:()=>({...z(),onSubmit:e=>(e.preventDefault(),o&&o({query:v}),null==x||x.tracker.trackSearchSubmit(v,{original_query:v}),{query:v}),className:"cio-form","data-testid":"cio-form"}),setQuery:g,cioClient:x}},d=e.createContext({});function m(e){const{children:t,...n}=e,o=u(n);return i.default.createElement(d.Provider,{value:{...o}},i.default.createElement("div",{className:"cio-autocomplete"},t))}function p(t){var n;const{item:o,index:r,sectionIdentifier:c,children:l}=t,{getItemProps:a}=e.useContext(d);let s;return s=function(e){return void 0!==e.data.image_url}(o)?i.default.createElement(i.default.Fragment,null,i.default.createElement("img",{"data-testid":"cio-img",src:null===(n=o.data)||void 0===n?void 0:n.image_url,alt:o.value}),i.default.createElement("p",{"data-testid":"cio-text"},o.value)):o.value,i.default.createElement("li",{...a({item:o,index:r,sectionIdentifier:c}),className:"cio-item"},l||s)}function f(e){const{section:t,children:n=v}=e;return n({section:t})}const v=({section:e})=>{var t;const n=(null==e?void 0:e.displayName)||(null==e?void 0:e.identifier);return i.default.createElement("li",{className:`${n} cio-section`},i.default.createElement("h5",{className:"cio-sectionName"},n.replace(/([A-Z])/g," $1").replace(/^./,(function(e){return e.toUpperCase()}))),i.default.createElement("ul",{className:"cio-items"},null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.map(((t,n)=>{var o;return i.default.createElement(p,{item:t,index:n,sectionIdentifier:null==e?void 0:e.identifier,key:`${null==e?void 0:e.identifier}_${null===(o=null==t?void 0:t.data)||void 0===o?void 0:o.id}`})}))))};function g(t){const{children:n=h}=t,{sections:o,isOpen:r,getMenuProps:c,getItemProps:l}=e.useContext(d),a=o&&o.some((e=>{var t;return null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.length}));let s;s=r&&a?"function"==typeof n?n({sections:o,getItemProps:l}):n:null;const u={...c()};return i.default.createElement("ul",{...u},s)}!function(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&o.firstChild?o.insertBefore(i,o.firstChild):o.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}(".cio-autocomplete {\n  font-family: Arial, Helvetica, sans-serif;\n  padding: 20px;\n}\n\n.cio-autocomplete .cio-items {\n  padding: 0;\n}\n\n.cio-autocomplete .cio-item {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n}\n\n.cio-autocomplete .cio-item img {\n  width: 100%;\n}\n\n.cio-autocomplete .products.cio-section .cio-item {\n  align-items: center;\n  justify-content: start;\n}\n\n.cio-autocomplete .products.cio-section .cio-items {\n  display: flex;\n}\n\n.cio-autocomplete .cio-form {\n  position: relative;\n  z-index: 100;\n  width: 300px;\n  top: 0px;\n  right: -8px;\n  height: 30px;\n}\n\n.cio-autocomplete .cio-input {\n  width: 100%;\n  height: 100%;\n  border: 1px solid gray;\n  padding: 0 10px;\n  border-radius: 3px;\n}\n\n.cio-autocomplete .cio-form .cio-btn,\n.cio-autocomplete .cio-form .cio-clear-btn {\n  position: absolute;\n  top: 1px;\n  bottom: -1px;\n  right: -21px;\n}\n\n.cio-autocomplete .cio-form .cio-btn[type='submit'] {\n  right: -21px;\n}\n\n.cio-autocomplete .cio-form .cio-clear-btn {\n  right: 10px;\n}\n\n.cio-autocomplete .cio-form .cio-icon {\n  display: flex;\n}\n\n.cio-autocomplete .cio-results {\n  background-color: white;\n  gap: 20px;\n  padding-left: 0px;\n  list-style: none;\n  display: flex;\n  flex-direction: row;\n  z-index: 1000;\n}\n\n.cio-autocomplete .cio-sectionName {\n  margin: 15px 0 20px 0;\n  font-size: 22px;\n}\n\n.cio-autocomplete .cio-results .cio-section.searchSuggestions .cio-items {\n  flex-direction: column;\n  min-width: 200px;\n}\n\n.cio-autocomplete .cio-item {\n  list-style: none;\n}\n\n.cio-autocomplete .cio-item {\n  padding: 10px;\n  margin: 1px;\n  border-bottom: 3px solid transparent;\n}\n\n.cio-autocomplete .cio-item img {\n  max-width: 100px;\n}\n\n.cio-autocomplete [aria-selected='true'] {\n  background-color: hsl(0, 0%, 90%);\n  border-radius: 4px;\n}\n\n.cio-autocomplete .cio-results[role='listbox'].showing-content {\n  position: relative;\n  top: 2px;\n  left: 8px;\n  max-width: 90vw;\n  background: white;\n  margin: 0px;\n  box-shadow: 0 2px 2px 1px grey;\n  overflow: auto;\n}\n");const h=({sections:e})=>i.default.createElement(i.default.Fragment,null,null==e?void 0:e.map((e=>i.default.createElement(f,{section:e,key:e.identifier}))));function x(t){const{children:n=y}=t,{getFormProps:o,getInputProps:i,getLabelProps:r,setQuery:c}=e.useContext(d);return n({getFormProps:o,getInputProps:i,getLabelProps:r,setQuery:c})}const y=({getFormProps:e,getInputProps:t,getLabelProps:n,setQuery:o})=>{const r=t();return i.default.createElement("form",{...e()},i.default.createElement("label",{...n(),hidden:!0},"Search"),i.default.createElement("input",{...r}),i.default.createElement("button",{className:"cio-clear-btn","data-testid":"cio-clear-btn",hidden:!r.value,onClick:()=>{var e;o(""),r.id&&(null===(e=document.getElementById(r.id))||void 0===e||e.focus())},type:"button","aria-label":"Clear search field text"},i.default.createElement("div",{className:"cio-icon"},i.default.createElement("svg",{stroke:"currentColor",fill:"currentColor",strokeWidth:"0",viewBox:"0 0 512 512",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg"},i.default.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})))),i.default.createElement("button",{className:"cio-btn","data-testid":"cio-btn",disabled:!r.value,type:"submit","aria-label":"Submit Search"},i.default.createElement("div",{className:"cio-icon"},i.default.createElement("svg",{stroke:"currentColor",fill:"currentColor",strokeWidth:"0",viewBox:"0 0 512 512",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg"},i.default.createElement("path",{d:"M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"})))))};exports.AutocompleteResults=g,exports.CioAutocomplete=function(e){const{children:t}=e;return t?i.default.createElement(m,{...e},t):i.default.createElement("div",null,i.default.createElement(m,{...e},i.default.createElement(x,null),i.default.createElement(g,null)))},exports.SearchInput=x,exports.SectionItem=p,exports.SectionItemsList=f,exports.useCioAutocomplete=u;
//# sourceMappingURL=index.js.map
